(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{389:function(e,t,s){"use strict";s.r(t);var a=s(32),n=Object(a.a)({},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"cloudlinux-os-kernel"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cloudlinux-os-kernel","aria-hidden":"true"}},[e._v("#")]),e._v(" CloudLinux OS kernel")]),e._v(" "),s("p",[e._v("This documentation describes specific features of the CloudLinux kernel. In other cases the kernel has the same features and innovations as any similar RHEL kernel.\nMore information about the actual kernel changes and releases can be obtained from our "),s("a",{attrs:{href:"https://changelog.cloudlinux.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("changelog"),s("OutboundLink")],1),e._v(".")]),e._v(" "),s("ul",[s("li",[s("RouterLink",{attrs:{to:"/cloudlinux_os_kernel/#hybrid-kernels"}},[e._v("Hybrid Kernels")])],1),e._v(" "),s("li",[s("RouterLink",{attrs:{to:"/cloudlinux_os_kernel/#securelinks-and-link-traversal-protection"}},[e._v("SecureLinks and Link Traversal Protection")])],1),e._v(" "),s("li",[s("RouterLink",{attrs:{to:"/cloudlinux_os_kernel/#file-change-api"}},[e._v("File change API")])],1),e._v(" "),s("li",[s("RouterLink",{attrs:{to:"/cloudlinux_os_kernel/#tuned-profiles-cloudlinux"}},[e._v("Tuned-profiles-cloudlinux")])],1),e._v(" "),s("li",[s("RouterLink",{attrs:{to:"/cloudlinux_os_kernel/#kernel-config-variables"}},[e._v("Kernel config variables")])],1),e._v(" "),s("li",[s("RouterLink",{attrs:{to:"/cloudlinux_os_kernel/#virtualized-proc-filesystem"}},[e._v("Virtualized /proc filesystem")])],1),e._v(" "),s("li",[s("RouterLink",{attrs:{to:"/cloudlinux_os_kernel/#ptrace-block"}},[e._v("Ptrace block")])],1),e._v(" "),s("li",[s("RouterLink",{attrs:{to:"/cloudlinux_os_kernel/#xen-xvda"}},[e._v("Xen XVDA")])],1),e._v(" "),s("li",[s("RouterLink",{attrs:{to:"/cloudlinux_os_kernel/#umask-behavior"}},[e._v("Umask behavior")])],1),e._v(" "),s("li",[s("RouterLink",{attrs:{to:"/cloudlinux_os_kernel/#io-limits-latency"}},[e._v("IO limits latency")])],1),e._v(" "),s("li",[s("RouterLink",{attrs:{to:"/cloudlinux_os_kernel/#reading-lve-usage"}},[e._v("Reading LVE usage")])],1),e._v(" "),s("li",[s("RouterLink",{attrs:{to:"/cloudlinux_os_kernel/#flashcache"}},[e._v("Flashcache")])],1),e._v(" "),s("li",[s("RouterLink",{attrs:{to:"/cloudlinux_os_kernel/#oom-killer-for-lve-processes"}},[e._v("OOM killer for LVE processes")])],1),e._v(" "),s("li",[s("RouterLink",{attrs:{to:"/cloudlinux_os_kernel/#file-system-quotas"}},[e._v("File system quotas")])],1),e._v(" "),s("li",[s("RouterLink",{attrs:{to:"/cloudlinux_os_kernel/#enter-lve-when-using-cpanel-utilities"}},[e._v("Enter LVE when using cPanel utilities")])],1),e._v(" "),s("li",[s("RouterLink",{attrs:{to:"/cloudlinux_os_kernel/#proactive-reporting-kernel-crash-events-with-sentry-and-kernel-panic-receiver"}},[e._v("Proactive reporting kernel crash events with Sentry and Kernel Panic Receiver")])],1)]),e._v(" "),s("h2",{attrs:{id:"hybrid-kernels"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hybrid-kernels","aria-hidden":"true"}},[e._v("#")]),e._v(" Hybrid Kernels")]),e._v(" "),s("p",[e._v("Hybrid kernels give you the ability to take advantage of the benefits and features available in newer kernels without having to completely upgrade to another version of the operating system. Example - for the CloudLinux 7 kernel, based on version 3.10, you can install a hybrid kernel (same as on CloudLinux 8), which is based on version 4.18. This provides more kernel options, memory and overall optimization, as well as a positive impact on system performance.")]),e._v(" "),s("h4",{attrs:{id:"how-to-migrate-from-the-normal-kernel-to-hybrid-one"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#how-to-migrate-from-the-normal-kernel-to-hybrid-one","aria-hidden":"true"}},[e._v("#")]),e._v(" How to migrate from the normal kernel to hybrid one")]),e._v(" "),s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[e._v("Note")]),s("p",[e._v("The system must have an active CloudLinux OS license")])]),s("div",{staticClass:"warning custom-block"},[s("p",{staticClass:"custom-block-title"},[e._v("Warning")]),s("p",[e._v("If you use "),s("code",[e._v("yum-plugin-protectbase")]),e._v(", please make sure it is disabled before stating the normal-to-hybrid script.")])]),s("p",[e._v("You should perform the following commands:")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("yum update\nnormal-to-hybrid\n")])])]),s("p",[e._v("Then if the script execution is completed without errors - perform the server reboot.")]),e._v(" "),s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[e._v("Note")]),s("p",[e._v("You can always migrate from the hybrid kernel to normal one with the following commands:")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("yum update\nhybrid-to-normal\n")])])])]),s("h4",{attrs:{id:"known-limitations-and-issues-of-hybrid-kernels"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#known-limitations-and-issues-of-hybrid-kernels","aria-hidden":"true"}},[e._v("#")]),e._v(" Known limitations and issues of hybrid kernels")]),e._v(" "),s("p",[s("strong",[e._v("CloudLinux OS Shared 6 Hybrid kernel")])]),e._v(" "),s("ol",[s("li",[s("p",[e._v("We do not remove Hybrid kernel after migration from Hybrid to the normal channel, but we remove "),s("span",{staticClass:"notranslate"},[e._v(" linux-firmware ")]),e._v(" package which is needed to boot Hybrid kernel. This is because "),s("span",{staticClass:"notranslate"},[e._v(" CloudLinux OS Shared")]),e._v(" 6 does not allow to remove the package of currently running kernel. Thus please don't reboot the server back to Hybrid kernel after you remove it.")])]),e._v(" "),s("li",[s("p",[e._v("Kernel module signature isn't checking for now, as 3.10 kernel is using x509 certificates to generate keys and CloudLinux OS Shared 6 cannot detect signatures created in such way.")])])]),e._v(" "),s("h2",{attrs:{id:"securelinks-and-link-traversal-protection"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#securelinks-and-link-traversal-protection","aria-hidden":"true"}},[e._v("#")]),e._v(" SecureLinks and Link Traversal Protection")]),e._v(" "),s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[e._v("Note")]),s("p",[e._v("Link Traversal Protection is disabled by default for the CloudLinux OS Shared.")])]),s("p",[e._v("CloudLinux OS Shared and CloudLinux OS Admin provides comprehensive protection against\nsymbolic link attacks popular in shared hosting environment.")]),e._v(" "),s("p",[e._v("The protection requires setting multiple kernel parameters to be enabled:")]),e._v(" "),s("p",[s("strong",[e._v("SecureLinks:")])]),e._v(" "),s("ul",[s("li",[s("RouterLink",{attrs:{to:"/cloudlinux_os_kernel/#fs-enforce-symlinksifowner"}},[e._v("fs.enforce_symlinksifowner")])],1),e._v(" "),s("li",[s("RouterLink",{attrs:{to:"/cloudlinux_os_kernel/#fs-symlinkown-gid"}},[e._v("fs.symlinkown_gid")])],1)]),e._v(" "),s("p",[s("strong",[e._v("Link Traversal Protection:")])]),e._v(" "),s("ul",[s("li",[s("RouterLink",{attrs:{to:"/cloudlinux_os_kernel/#fs-protected-symlinks-create"}},[e._v("fs.protected_symlinks_create")])],1),e._v(" "),s("li",[s("RouterLink",{attrs:{to:"/cloudlinux_os_kernel/#fs-process-symlinks-by-task"}},[e._v("fs.process_symlinks_by_task")])],1)]),e._v(" "),s("p",[e._v("Please reffer to "),s("a",{attrs:{href:"https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/managing_monitoring_and_updating_the_kernel/configuring-kernel-parameters-at-runtime_managing-monitoring-and-updating-the-kernel#doc-wrapper",target:"_blank",rel:"noopener noreferrer"}},[e._v("this article"),s("OutboundLink")],1),e._v(" in order to know how to setup these parameters.")]),e._v(" "),s("h4",{attrs:{id:"fs-enforce-symlinksifowner"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fs-enforce-symlinksifowner","aria-hidden":"true"}},[e._v("#")]),e._v(" "),s("strong",[e._v("fs.enforce_symlinksifowner")])]),e._v(" "),s("p",[e._v("To protect against symlink attack where attacker tricks Apache web server to read some other user PHP config files, or other sensitive file, enable:")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("fs.enforce_symlinksifowner=1\n")])])]),s("p",[e._v("Setting this parameter will deny any process running under gid "),s("em",[e._v("fs.symlinkown_gid")]),e._v(" to follow the symlink if owner of the link doesn’t match the owner of the target file.")]),e._v(" "),s("p",[e._v("Defaults:")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("fs.enforce_symlinksifowner = 1\nfs.symlinkown_gid = 48\n")])])]),s("table",[s("thead",[s("tr",[s("th"),e._v(" "),s("th")])]),e._v(" "),s("tbody",[s("tr",[s("td",[s("span",{staticClass:"notranslate"},[s("em",[e._v("fs.enforce_symlinksifowner = 0")])])]),e._v(" "),s("td",[e._v("do not check "),s("span",{staticClass:"notranslate"},[e._v(" symlink ")]),e._v(" ownership")])]),e._v(" "),s("tr",[s("td",[s("span",{staticClass:"notranslate"},[s("em",[e._v("fs.enforce_symlinksifowner = 1")])])]),e._v(" "),s("td",[e._v("deny if "),s("span",{staticClass:"notranslate"},[e._v(" symlink ")]),e._v(" ownership doesn’t match target, and process "),s("span",{staticClass:"notranslate"},[e._v(" gid ")]),e._v(" matches "),s("span",{staticClass:"notranslate"},[e._v(" _symlinkown_gid")])])])])]),e._v(" "),s("p",[e._v("When "),s("span",{staticClass:"notranslate"},[s("em",[e._v("fs.enforce_symlinksifowner")])]),e._v(" set to 1, processes with "),s("span",{staticClass:"notranslate"},[e._v(" GID ")]),e._v(" 48 will not be able to follow "),s("span",{staticClass:"notranslate"},[e._v(" symlinks ")]),e._v(" if they are owned by "),s("span",{staticClass:"notranslate"},[e._v(" user1 ")]),e._v(" , but point to file owned "),s("span",{staticClass:"notranslate"},[e._v(" user2 ")]),e._v(" .")]),e._v(" "),s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[e._v("Note")]),s("p",[s("em",[e._v("fs.enforce_symlinksifowner = 2")]),e._v(" is deprecated and can cause issues for the system operation.")])]),s("h5",{attrs:{id:"fs-symlinkown-gid"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fs-symlinkown-gid","aria-hidden":"true"}},[e._v("#")]),e._v(" "),s("strong",[e._v("fs.symlinkown_gid")])]),e._v(" "),s("p",[e._v("On standard Apache installation, this webserver is usually running under GID 48.\nOn cPanel servers, Apache is running under user nobody, GID 99.")]),e._v(" "),s("p",[e._v("To change GID of processes that cannot follow symlink, edit the file "),s("em",[e._v("/etc/sysctl.conf")]),e._v(" , add the line:")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("fs.symlinkown_gid = XX\n")])])]),s("p",[e._v("And execute:")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("$ sysctl -p\n")])])]),s("p",[e._v("To disable symlink owner match protection feature, set  "),s("em",[e._v("fs.enforce_symlinksifowner = 0")]),e._v(" in "),s("em",[e._v("/etc/sysctl.conf")]),e._v(" , and execute:")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("$ sysctl -p\n")])])]),s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[e._v("Note")]),s("p",[s("em",[e._v("fs.symlinkown_gid")]),e._v(" parameter values for httpd service user and "),s("em",[e._v("fs.proc_super_gid")]),e._v(" for nagios service user is written to "),s("em",[e._v("/etc/sysctl.d/90-cloudlinux.conf")]),e._v(".")])]),s("h4",{attrs:{id:"fs-protected-symlinks-create"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fs-protected-symlinks-create","aria-hidden":"true"}},[e._v("#")]),e._v(" "),s("strong",[e._v("fs.protected_symlinks_create")]),e._v(" "),s("Badge",{attrs:{text:"cPanel"}})],1),e._v(" "),s("div",{staticClass:"warning custom-block"},[s("p",{staticClass:"custom-block-title"},[e._v("Warning")]),s("p",[e._v("When used outside CageFS (from cPanel tools for instance), "),s("span",{staticClass:"notranslate"},[s("code",[e._v("fs.protected_symlinks_create")])]),e._v(" isn't sufficient for symlink protection.\nTo fully protect symlink access in this case, use "),s("span",{staticClass:"notranslate"},[s("code",[e._v("fs.process_symlinks_by_task=1")])]),e._v(" in addition to "),s("span",{staticClass:"notranslate"},[s("code",[e._v("fs.protected_symlinks_create=1")])]),e._v(".")])]),s("p",[s("span",{staticClass:"notranslate"},[s("RouterLink",{attrs:{to:"/cloudlinux_os_components/#cagefs"}},[e._v("CageFS")])],1),e._v(" is extremely powerful at stopping most information disclosure attacks, where a hacker could read sensitive files like "),s("span",{staticClass:"notranslate"},[s("em",[e._v("/etc/passwd")])]),e._v(" .")]),e._v(" "),s("p",[e._v("Yet, "),s("span",{staticClass:"notranslate"},[e._v(" CageFS ")]),e._v(" does not work in each and every situation. For example, on "),s("span",{staticClass:"notranslate"},[e._v(" cPanel ")]),e._v(" servers, it is not enabled in "),s("span",{staticClass:"notranslate"},[e._v(" WebDAV ")]),e._v(" server, "),s("span",{staticClass:"notranslate"},[e._v(" cPanel ")]),e._v(" file manager and webmail, as well as some FTP servers don’t include proper change rooting.")]),e._v(" "),s("p",[e._v("This allows an attacker to create symlink or hardlink to a sensitive file like "),s("span",{staticClass:"notranslate"},[s("em",[e._v("/etc/passwd")])]),e._v(" and then use "),s("span",{staticClass:"notranslate"},[e._v(" WebDAV ")]),e._v(" , filemanager, or webmail to read the content of that file.")]),e._v(" "),s("p",[e._v("You can prevent such attacks by preventing user from creating symlinks and hardlinks to files that they don’t own.")]),e._v(" "),s("p",[e._v("This is done by set following kernel options to 1:\n")]),s("div",{staticClass:"notranslate"},[s("p"),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("fs.protected_symlinks_create = 1\nfs.protected_hardlinks_create = 1\n")])])])]),e._v(" "),s("div",{staticClass:"danger custom-block"},[s("p",{staticClass:"custom-block-title"},[e._v("DANGER")]),s("p",[e._v("We do not recommend to use protected_symlinks option for cPanel users as it might break some of the cPanel functionality.\nPlease read the known issues section before enabling this feature.")])]),s("ul",[s("li",[s("RouterLink",{attrs:{to:"/cloudlinux_os_kernel/#known-issues-with-fs-protected-symlinks-create-1-on-cpanel-servers"}},[e._v("Known issues with fs.protected_symlinks_create=1 on cPanel servers")])],1)]),e._v(" "),s("h4",{attrs:{id:"fs-process-symlinks-by-task"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fs-process-symlinks-by-task","aria-hidden":"true"}},[e._v("#")]),e._v(" "),s("strong",[e._v("fs.process_symlinks_by_task")]),e._v(" "),s("Badge",{attrs:{text:"cPanel"}})],1),e._v(" "),s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[e._v("Note")]),s("p",[e._v("This option only available on CloudLinux 7 Hybrid or on CloudLinux 8 Shared and Admin editions.\nAlso please note that this feature is available for cPanel only.")])]),s("p",[e._v("This parameter is needed to protect against symlink vulnerability where an attacker might get access to files out of the CageFS via cPanel tools: File Manager, WebDAV, Webmail, etc. When a symlink is accessed from cPanel tools (non-root user case) we check whether the current process UID matches the symlink target UID.")]),e._v(" "),s("p",[e._v("To enable the protection for CloudLinux OS Shared , set the "),s("span",{staticClass:"notranslate"},[s("code",[e._v("fs.process_symlinks_by_task")])]),e._v(" parameter to 1:\n")]),s("div",{staticClass:"notranslate"},[s("p"),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("fs.process_symlinks_by_task=1\n")])])])]),e._v(" "),s("p",[e._v("To disable the protection for CloudLinux OS Shared 7 hybrid, set the "),s("span",{staticClass:"notranslate"},[s("code",[e._v("fs.process_symlinks_by_task")])]),e._v(" parameter to 0:\n")]),s("div",{staticClass:"notranslate"},[s("p"),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("fs.process_symlinks_by_task=0\n")])])])]),e._v(" "),s("h4",{attrs:{id:"known-issues-with-fs-protected-symlinks-create-1-on-cpanel-servers"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#known-issues-with-fs-protected-symlinks-create-1-on-cpanel-servers","aria-hidden":"true"}},[e._v("#")]),e._v(" Known issues with fs.protected_symlinks_create=1 on cPanel servers")]),e._v(" "),s("p",[e._v("Here are some examples of what may go wrong on cPanel servers. If "),s("span",{staticClass:"notranslate"},[s("code",[e._v("fs.protected_symlinks_create=1")])]),e._v(" is set on the server, it can cause the following issues:")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("rsync")]),e._v(" is failed")])]),e._v(" "),s("p",[e._v("If you use the "),s("code",[e._v("rsync")]),e._v(" to copy/transfer files and they contain symlinks, you'll see the errors like these:")]),e._v(" "),s("div",{staticClass:"notranslate"},[s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('"rsync error: some files could not be transferred (code 23)" and the transfer will be failed. \n')])])])]),e._v(" "),s("p",[e._v("It affects "),s("code",[e._v("rsync")]),e._v(" tasks as well as cPanel transfer tools.")]),e._v(" "),s("ul",[s("li",[e._v("backup extracting may not work. Errors during the restoration:")])]),e._v(" "),s("div",{staticClass:"notranslate"},[s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("Error extracting /home/domain/backups/home.tar.gz : /bin/tar: .cagefs/tmp/mysql.sock: Cannot create symlink to `/var/lib/mysql/mysql.sock'.\nPermission denied. /bin/tar: .cagefs/tmp/.s.PGSQL.5432: Cannot create symlink to `/var/run/postgres/.s.PGSQL.5432': No such file or directory.\n")])])])]),e._v(" "),s("p",[e._v("Any backup for accounts (including cPanel backup) cannot be extracted.")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("dmesg")]),e._v(" is flooded with the "),s("span",{staticClass:"notranslate"},[s("code",[e._v("may_create_sym_link")])]),e._v(" messages like:")])]),e._v(" "),s("div",{staticClass:"notranslate"},[s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("may_create_sym_link: can't find ea-phpXX in cron\nmay_create_sym_link: can't find ea-phpXX in ea-php-cli\n")])])])]),e._v(" "),s("p",[e._v("It's popping up each second and may increase the size of the "),s("span",{staticClass:"notranslate"},[s("code",[e._v("/var/log/messages")])]),e._v(" file.")]),e._v(" "),s("h2",{attrs:{id:"file-change-api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#file-change-api","aria-hidden":"true"}},[e._v("#")]),e._v(" File change API")]),e._v(" "),s("h3",{attrs:{id:"general"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#general","aria-hidden":"true"}},[e._v("#")]),e._v(" General")]),e._v(" "),s("p",[s("strong",[e._v("General description")])]),e._v(" "),s("p",[e._v("One of the main problems on a shared hosting system for file backup operations is to figure out which files have changed. Using "),s("span",{staticClass:"notranslate"},[e._v(" INOTIFY ")]),e._v(" on a 1T drive with a large number of small files and directories guarantees slow startup times, and a lot of context switching between kernel and userspace - generating additional load. On the other hand scanning disk for newly modified files is very "),s("span",{staticClass:"notranslate"},[e._v(" IO ")]),e._v(" intensive, and can kill the performance of the fastest disks.")]),e._v(" "),s("p",[s("strong",[e._v("CloudLinux OS Shared approach")])]),e._v(" "),s("p",[s("span",{staticClass:"notranslate"},[e._v(" CloudLinux File Change API ")]),e._v(" is a kernel level technology with the user space interface that buffers lists of modified files in the kernel and then off-loads that list to user space daemon.")]),e._v(" "),s("p",[e._v("After that - any software (with enough permissions) can get a list of files that has been modified for the last 24 hours.")]),e._v(" "),s("p",[e._v("The software is very simple to use and produces the  list of modified files. As such we expect file backup software, including integrated cPanel backup system to integrate with this "),s("span",{staticClass:"notranslate"},[e._v(" API ")]),e._v(" soon.")]),e._v(" "),s("h3",{attrs:{id:"usage-and-integration"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#usage-and-integration","aria-hidden":"true"}},[e._v("#")]),e._v(" Usage and integration")]),e._v(" "),s("p",[s("strong",[e._v("Userland utilities")])]),e._v(" "),s("p",[s("span",{staticClass:"notranslate"},[e._v("/usr/bin/cloudlinux-backup-helper ")]),e._v(" is a utility for getting the list of changed files.")]),e._v(" "),s("p",[e._v("It is supposed to be run by a super user only.")]),e._v(" "),s("p",[e._v("Command line parameters:\n")]),s("div",{staticClass:"notranslate"},[s("p"),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("-t | --timestamp retrieve file names for files modified after specified timestamp\n-u | --uid       retrieve file names for particular UID only\n")])])])]),e._v("\nIf no UID specified, are retrieved for all users. If no timestamp specified, all database events are shown.\n"),s("p",[s("strong",[e._v("Output format")])]),s("div",{staticClass:"notranslate"},[s("p"),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("protocol version (1 right now), timestamp (in seconds) - up to which time data was collected\nUID:absolute path to file changed\nUID:absolute path to file changed\n…\n")])])])]),e._v(" "),s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[e._v("Note")]),s("p",[e._v("The timestamp in output is needed so you can clearly identify from which timestamp to get list of changed files next.")])]),s("p",[s("strong",[s("em",[e._v("Examples:")])])]),s("div",{staticClass:"notranslate"},[s("p"),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("[root@localhost ~]# cloudlinux-backup-helper -t 1495533489 -u <UID>\n1,1495533925\n1001:/home/user2/public_html/output.txt\n1001:/home/user2/public_html/info.php\n[root@localhost ~]# cloudlinux-backup-helper -t 1495533489\n1,1495533925\n1000:/home/user1/.bashrc\n1001:/home/user2/public_html/output.txt\n1001:/home/user2/public_html/info.php\n1003:/home/user3/logs/data.log\n")])])])]),e._v("\n**Getting changed files by end user**\n"),s("p",[s("span",{staticClass:"notranslate"},[e._v("/usr/bin/cloudlinux-backup-helper-uid")]),e._v("  is a SUID wrapper for the  "),s("span",{staticClass:"notranslate"},[e._v(" cloudlinux-backup-helper ")]),e._v("  utility that enables an end user to get the list of files changed. It accepts timestamp argument only and retrieves data of the user who is running it only.")]),e._v(" "),s("p",[s("strong",[s("em",[e._v("Examples:")])])]),s("div",{staticClass:"notranslate"},[s("p"),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("[user@localhost ~]$ cloudlinux-backup-helper-uid               \n1,1495530576\n1000:/home/user/.bash_history \n\n[user@localhost ~]$ cloudlinux-backup-helper-uid -t 1495547922\n1,1495548343\n1000:/home/user/file1.txt\n1000:/home/user/file2.txt\n")])])])]),e._v("\nThis command is available within CageFS.\n"),s("h3",{attrs:{id:"installation-and-configuration"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#installation-and-configuration","aria-hidden":"true"}},[e._v("#")]),e._v(" Installation and configuration")]),e._v(" "),s("p",[s("span",{staticClass:"notranslate"},[s("strong",[e._v("cloudlinux-fchange-0.1-5")])])]),e._v(" "),s("p",[s("strong",[e._v("Requirements")])]),e._v(" "),s("p",[s("span",{staticClass:"notranslate"},[e._v(" CloudLinux OS ")]),e._v(" 6 (requires Hybrid kernel) or 7\nKernel Version: 3.10.0-427.36.1.lve1.4.47")]),e._v(" "),s("p",[s("strong",[e._v("Installation and configuration")])]),e._v(" "),s("p",[e._v("To install "),s("span",{staticClass:"notranslate"},[e._v(" cloudlinux-fchange ")]),e._v(" system run:")]),e._v(" "),s("p",[s("em",[e._v("CloudLinux OS Shared 7:")])]),s("div",{staticClass:"notranslate"},[s("p"),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("yum install cloudlinux-fchange --enablerepo=cloudlinux-updates-testing\n")])])])]),e._v(" "),s("p",[s("em",[e._v("CloudLinux OS Shared 6 Hybrid:")])]),e._v(" "),s("div",{staticClass:"notranslate"},[s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("yum install cloudlinux-fchange --enablerepo=cloudlinux-hybrid-testing\n")])])])]),e._v("\nConfiguration file can be found in "),s("span",{staticClass:"notranslate"},[e._v("/etc/sysconfig/cloudlinux-fchange ")]),e._v(" "),s("p",[e._v("Database containing list of modified files is located at "),s("span",{staticClass:"notranslate"},[e._v("/var/lve/cloudlinux-fchange.db ")]),e._v(" by default.")]),e._v(" "),s("p",[s("strong",[e._v("Starting and stopping")])]),e._v(" "),s("p",[e._v("After successful installation the event collecting daemon starts automatically, providing all "),s("span",{staticClass:"notranslate"},[e._v(" kernel-exposed ")]),e._v(" data are in place.")]),e._v(" "),s("p",[e._v("To start daemon:\n"),s("span",{staticClass:"notranslate"},[s("em",[e._v("CloudLinux OS Shared 7:")])])]),e._v(" "),s("div",{staticClass:"notranslate"},[s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("systemctl start cloudlinux-file-change-collector\n")])])])]),e._v(" "),s("p",[s("em",[e._v("CloudLinux OS Shared 6 Hybrid:")])]),e._v(" "),s("div",{staticClass:"notranslate"},[s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("service cloudlinux-file-change-collector start\n")])])])]),e._v("\nTo stop daemon:\n"),s("span",{staticClass:"notranslate"}),e._v("\n_CloudLinux OS Shared 7:_\n"),s("div",{staticClass:"notranslate"},[s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("systemctl stop cloudlinux-file-change-collector\n")])])])]),e._v(" "),s("p",[s("em",[e._v("CloudLinux OS Shared 6 Hybrid:")])]),e._v(" "),s("div",{staticClass:"notranslate"},[s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("service cloudlinux-file-change-collector stop\n")])])])]),e._v(" "),s("p",[e._v("To uninstall "),s("span",{staticClass:"notranslate"},[e._v(" cloudlinux-fchange ")]),e._v(" run:\n")]),s("div",{staticClass:"notranslate"},[s("p"),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("yum remove cloudlinux-fchange\n")])])])]),e._v(" "),s("h3",{attrs:{id:"configuration-details"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configuration-details","aria-hidden":"true"}},[e._v("#")]),e._v(" Configuration details")]),e._v(" "),s("p",[e._v("Configuration resides in "),s("span",{staticClass:"notranslate"},[e._v("/etc/sysconfig/cloudlinux-fchange")]),e._v(". The following is the default configuration (see comments):\n")]),s("div",{staticClass:"notranslate"},[s("p"),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("# sqlite database file path. If commented out a default value is used\n#database_path=/var/lve/cloudlinux-fchange.db\n\n# If uncommented paths starting with 'include' one are processed only\n# Pay attention this parameter is a regular string, not a regex\n# To include more than one item just specify several lines to include:\n# include=/one\n# include=/two\n\n# If uncommented exclude paths which contain 'exclude'\n# Pay attention this parameter is a regular string, not a regex\n# To exclude more than one item just specify several lines to exclude:\n# exclude=var\n# exclude=tmp\n\n# Daemon polling interval in seconds\npolling_interval=5 \n\n# Time to keep entries in days. Does not clean if commented out or zero\ntime_to_keep=1\n\n# User read-only mode minimal UID\n# If file change collector stopped, all users with UID >= user_ro_mode_min_uid\n# are restricted to write to their home directory. This prevents to miss\n# a file change event.\n# Value of -1 (default) allows to disable the feature\nuser_ro_mode_min_uid=-1\n\n# Minimal UID of events to be processed.\n# Events of users with UID less then specified are not handled.\n# By default 500 (non-system users for redhat-based systems)\n#minimal_event_uid=500\n \n# SQLite shared lock prevents setting more restrictive locks. That is a\n# process cannot write to a database table when a concurrent process reads\n# from the table. As saving data to database is considered far more important\n# than getting them (data could be reread a second later after all), database\n# writer could try to terminate concurrent reading processes. Just set\n# terminate rivals to 'yes' to turn this ability on.\n# terminate_rivals=no \n\n# Events to be handled. Currently the following types of events are processed:\n# 1. file creation\n# 2. file deletion\n# 3. directory creation\n# 4. directory deletion\n# 5. file content/metadata modification\n# 6. file/directory attributes/ownership modification\n# 7. hardlink creation\n# 8. symlink creation\n# 9. file/directory moving/renaming\n# By default all events are processed. Keep in mind that events for a filepath\n# are cached, i.e if a file was deleted and then a file with the same absolute\n# name is created, only the deletion event is triggerred. Changing file\n# modification timestamp with command 'touch' will trigger modification event\n# as if a file content is modified.\n# Currently supported options are:\n# file_created, file_modified, file_deleted, dir_created, dir_deleted,\n# owner_changed, attrib_changed, moved, hardlink_created, symlink_created, all\n# Options that don't have 'file' or 'dir' prefix, applied to both files and\n# directories. To set more than one options, separate them with commas,\n# e.g. event_types=file_created,file_deleted,file_modified. Unknown options are\n# ignored.\n#\n# event_types=all\n")])])])]),e._v(" "),s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[e._v("Note")]),s("p",[e._v("Please keep in mind, that current implementation implies that one process is writing to a database and another is reading from it. As reading sets shared lock to a database table, the writing process cannot write to the table until the lock is released. That’s why passing a timestamp to cloudlinux-backup-helpermatters: this way the number of records to be returned is substantially decreased, lowering the processing time and filtering out old records. Likewise, pay attention to narrowing the scope of events being recorded. Chances are that changing attributes, ownership, directory creation/deletion, symlink events are not relevant and there’s no need to keep them.")])]),s("h3",{attrs:{id:"low-level-access"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#low-level-access","aria-hidden":"true"}},[e._v("#")]),e._v(" Low-level access")]),e._v(" "),s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[e._v("Note")]),s("p",[e._v("Using this options is dangerous, and might cause problems with "),s("span",{staticClass:"notranslate"},[e._v("CloudLinux File Change API.")])])]),s("p",[e._v("The kernel exposes the functionality to /proc/sys/fs/datacycle/ folder.")]),e._v(" "),s("ol",[s("li",[s("p",[s("span",{staticClass:"notranslate"},[s("strong",[e._v("enable")])]),e._v(" - enable/disable the functionality. Write 1 to this file to enable, 0 to disable. If disabled, no events are coming to events file.")])]),e._v(" "),s("li",[s("p",[s("span",{staticClass:"notranslate"},[s("strong",[e._v("events")])]),e._v(" - the modified files log itself. Events in the format "),s("span",{staticClass:"notranslate"},[e._v(" <EVENT_ID>:<EVENT_TYPE_ID>:<USER_ID>:<FILE_PATH> ")]),e._v(" are constantly appending to the end of the file if datacycle enabled. File events are never duplicated: if we have file modification event, we would not get file deletion event if the file has been later deleted. This events buffer has limited capacity, therefore from time to time, the events log requires flushing.")])]),e._v(" "),s("li",[s("p",[s("span",{staticClass:"notranslate"},[s("strong",[e._v("flush")])]),e._v(" - a file for clearing events log. For flushing, the last "),s("span",{staticClass:"notranslate"},[e._v(" event_id ")]),e._v(" from the events file is written to this file. Right after this, events log is truncated to that "),s("span",{staticClass:"notranslate"},[e._v(" event_id ")]),e._v(" .")])]),e._v(" "),s("li",[s("p",[s("span",{staticClass:"notranslate"},[s("strong",[e._v("user_ro_mode")])]),e._v(" - forbidding users with UIDs equal or bigger that set in this file writing to their home directories. At the boot, the file has -1. When it’s written positive value, say 500, the system starts effectively preventing users from modifying their home dirs (on write attempt a user gets "),s("span",{staticClass:"notranslate"},[e._v(" ‘read-only filesystem’ ")]),e._v(" error). This feature is designed to prevent users from updating their home dirs when events are not handled.")])]),e._v(" "),s("li",[s("p",[s("span",{staticClass:"notranslate"},[s("strong",[e._v("entries_in_buffer")])]),e._v(" - just counter of log entries of events file.")])]),e._v(" "),s("li",[s("p",[s("span",{staticClass:"notranslate"},[s("strong",[e._v("min_event_uid")])]),e._v(" - this file has minimal UID of events to be handled. Events from users with smaller UID are not handled. By default 500 (non-system users in redhat-based systems).")])])]),e._v(" "),s("h2",{attrs:{id:"tuned-profiles-cloudlinux"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tuned-profiles-cloudlinux","aria-hidden":"true"}},[e._v("#")]),e._v(" Tuned-profiles-cloudlinux")]),e._v(" "),s("p",[e._v("The "),s("span",{staticClass:"notranslate"},[s("strong",[s("em",[e._v("tuned-profiles-cloudlinux")])])]),e._v(" package brings a range of kernel under-the-hood tunings to address high LA, iowait issues what were detected earlier on particular users deploys. The package also encloses OOM adjustments to prioritize the elimination of overrun PHP, "),s("span",{staticClass:"notranslate"},[e._v(" lsphp, Phusion Passenger ")]),e._v(" workers processes over other processes (e.g. ssh, a cron job).")]),e._v(" "),s("p",[e._v("There are three profiles provided by CloudLinux OS Shared:\n")]),s("div",{staticClass:"notranslate"},[s("p"),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("# tuned-adm list | grep cloudlinux\n- cloudlinux-default          - Default CloudLinux tuned profile\n- cloudlinux-dummy            - Empty CloudLinux tuned profile\n- cloudlinux-vz               - Empty CloudLinux tuned profile\n")])])])]),e._v(" "),s("p",[s("span",{staticClass:"notranslate"},[e._v(" cloudlinux-dummy")]),e._v(" and  "),s("span",{staticClass:"notranslate"},[e._v(" cloudlinux-vz")]),e._v(" are used for internal needs or when  "),s("span",{staticClass:"notranslate"},[e._v(" Virtuozzo/OpenVZ ")]),e._v("  detected and actually do nothing.")]),e._v(" "),s("p",[s("span",{staticClass:"notranslate"},[e._v(" cloudlinux-default ")]),e._v(" is one to be used, it actually does the following:")]),e._v(" "),s("ol",[s("li",[e._v("Switches CPU power consumption mode to the maximum. CPU operates at maximum performance at the maximum clock rate:")])]),e._v(" "),s("div",{staticClass:"notranslate"},[s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("governor=performance\nenergy_perf_bias=performance\n")])])])]),e._v(" "),s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[e._v("Note")]),s("p",[e._v("If standard software CPU governors are used.")])]),s("ol",{attrs:{start:"2"}},[s("li",[e._v("Applies the following kernel options:"),s("br"),e._v(" "),s("span",{staticClass:"notranslate"},[e._v("\nvm.force_scan_thresh=100 ")]),e._v(" - Improves kernel memory clean-up in case of big number of running LVE.")])]),e._v(" "),s("p",[e._v("UBC parameters set the limits for the containers:")]),e._v(" "),s("p",[s("span",{staticClass:"notranslate"},[e._v("  ubc.dirty_ratio=100 ")]),e._v(" - Defines maximum RAM percentage for dirty memory pages.\n"),s("span",{staticClass:"notranslate"},[e._v(" dirty_background_ratio=75")]),e._v(" - Defines RAM percentage when to allow writing dirty pages on the disk.")]),e._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[s("em",[e._v("[CloudLinux OS Shared 7 only]")]),e._v(" Detects used disk types and changes elevator to "),s("span",{staticClass:"notranslate"},[e._v(" 'deadline' ")]),e._v(" for HDD and to "),s("span",{staticClass:"notranslate"},[e._v(" 'noop' ")]),e._v(" for SSD in "),s("span",{staticClass:"notranslate"},[e._v(" /sys/block/[blockname]/queue/scheduler ")]),e._v(" .")])]),e._v(" "),s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[e._v("Note")]),s("p",[s("span",{staticClass:"notranslate"},[e._v("The script uses /sys/block/[blockname]/queue/rotational flag, some RAID controllers can not set it properly. For example, SSD used for RAID but rotational is set to 1 by RAID driver. As a workaround add the following to /etc/rc.d/rc.local to make it applied on boot:")])])]),s("div",{staticClass:"notranslate"},[s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('echo "noop" > /sys/block/[blockname]/queue/scheduler  \necho "0" > /sys/block/[blockname]/queue/rotational\n')])])])]),e._v(" "),s("p",[e._v("Where "),s("span",{staticClass:"notranslate"},[s("em",[e._v("[blockname]")])]),e._v(" is used device name, like "),s("span",{staticClass:"notranslate"},[s("em",[e._v("sda/sdb")])]),e._v(" .")]),e._v(" "),s("p",[e._v("And make it executable:\n")]),s("div",{staticClass:"notranslate"},[s("p"),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("chmod +x /etc/rc.d/rc.local\n")])])])]),e._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[s("p",[s("em",[e._v("[CloudLinux OS Shared 7 only]")]),e._v(" The profile sets "),s("span",{staticClass:"notranslate"},[e._v(" I/O ")]),e._v(" scheduler. For the normal discs the "),s("span",{staticClass:"notranslate"},[e._v(" Deadline Scheduler ")]),e._v(" is set to improve "),s("span",{staticClass:"notranslate"},[e._v(" IO ")]),e._v(" performance and decrease "),s("span",{staticClass:"notranslate"},[e._v(" IO ")]),e._v(" latency, for SSD - noop.\nWhen configuring scheduler "),s("span",{staticClass:"notranslate"},[e._v(" I/O ")]),e._v(" queue is changed and set to the value 1024 which improves overall "),s("span",{staticClass:"notranslate"},[e._v(" I/O ")]),e._v(" subsystem performance by caching "),s("span",{staticClass:"notranslate"},[e._v(" IO ")]),e._v(" requests in memory.")])]),e._v(" "),s("li",[s("p",[e._v("Disables transparent "),s("span",{staticClass:"notranslate"},[e._v(" HugePage ")]),e._v(" .")])]),e._v(" "),s("li",[s("p",[e._v("Provides adjustment group file for OOM-Killer to kill overrun php, lsphp and "),s("span",{staticClass:"notranslate"},[e._v(" Phusion Passenger ")]),e._v(" workers first.")])])]),e._v(" "),s("p",[e._v("To install:")]),e._v(" "),s("div",{staticClass:"notranslate"},[s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("yum install tuned-profiles-cloudlinux\n")])])])]),e._v(" "),s("p",[e._v("To start using a profile:")]),e._v(" "),s("div",{staticClass:"notranslate"},[s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("tuned-adm profile cloudlinux-default\n")])])])]),e._v(" "),s("p",[e._v("To stop using a profile:")]),e._v(" "),s("div",{staticClass:"notranslate"},[s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("tuned-adm off\n")])])])]),e._v(" "),s("h2",{attrs:{id:"kernel-config-variables"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kernel-config-variables","aria-hidden":"true"}},[e._v("#")]),e._v(" Kernel config variables")]),e._v(" "),s("p",[e._v("Starting from "),s("strong",[e._v("lvemanager 4.0-25.5")]),e._v(", "),s("strong",[e._v("lve-utils 3.0-21.2")]),e._v(", and "),s("strong",[e._v("cagefs-6.1-26")]),e._v(", CloudLinux OS Shared utilities can read/write kernel config variables from a custom config /etc/sysctl.d/90-cloudlinux.conf (earlier, the parameters were read/written only from sysctl.conf ).")]),e._v(" "),s("p",[e._v("CloudLinux OS Shared utilities get parameter by using "),s("code",[e._v("sysctl")]),e._v(" system utility. So for now, even if a config variable is not set in the "),s("code",[e._v("sysctl.conf")]),e._v(" and in the "),s("code",[e._v("/etc/sysctl.d")]),e._v(" config files, this variable will be read by "),s("code",[e._v("sysctl")]),e._v(" utility directly from "),s("code",[e._v("/proc/sys")]),e._v(".")]),e._v(" "),s("p",[e._v("If you changed some kernel variables in "),s("code",[e._v("/etc/sysctl.d/90-cloudlinux.conf")]),e._v(" you need to apply these changes to the kernel parameter by running the command:")]),e._v(" "),s("div",{staticClass:"notranslate"},[s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("sysctl --system\n")])])])]),e._v(" "),s("p",[e._v("After that, the variable can be read by the sysctl utility.")]),e._v(" "),s("p",[e._v("Starting from "),s("strong",[e._v("cagefs-6.1-27")]),e._v(",  fs.proc_can_see_other_uid will be migrated (one time) from /etc/sysctl.conf into /etc/sysctl.d/90-cloudlinux.conf . If this variable is not set in either file, it will default to 0.\nIt is strongly advised against setting this variable in 90-cloudlinux.conf . Define it in /etc/sysctl.conf or in some other config file with an index number greater than 90-cloudlinux.conf , e.g. "),s("code",[e._v("/etc/sysctl.d/95-custom.conf")]),e._v(".")]),e._v(" "),s("p",[e._v("Starting from "),s("strong",[e._v("lve-utils-3.0-23.7")]),e._v("  fs.proc_super_gid and fs.symlinkown_gid will be migrated (one time) from /etc/sysctl.conf into /etc/sysctl.d/90-cloudlinux.conf .")]),e._v(" "),s("p",[e._v("For "),s("strong",[e._v("lve-utils")]),e._v(" versions from 3.0-21.2 to 3.0-23.7 the migration was performed the same way, but during every package install/update.\nVariables setting guidelines are the same as for CageFS (see above).")]),e._v(" "),s("p",[e._v("As requested by some our customers, we've implemented a new kernel setting to hide "),s("code",[e._v("/proc/net/{tcp,udp,unix}")]),e._v(" files for additional security/isolation.\nYou can hide them by runnign "),s("code",[e._v("sysctl -w kernel.proc_disable_net=1")]),e._v(" command, and by default, it's "),s("code",[e._v("0")]),e._v(" (nothing hidden).\nCurrently this is implemented for CloudLinux OS Shared 7 only.")]),e._v(" "),s("h2",{attrs:{id:"virtualized-proc-filesystem"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#virtualized-proc-filesystem","aria-hidden":"true"}},[e._v("#")]),e._v(" Virtualized /proc filesystem")]),e._v(" "),s("p",[e._v("You can prevent user from seeing processes of other users (via ps/top command) as well as special files in /proc file system by setting fs.proc_can_see_other_uid sysctl.")]),e._v(" "),s("p",[e._v("To do that, edit /etc/sysctl.conf\n")]),s("div",{staticClass:"notranslate"},[s("p"),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("fs.proc_can_see_other_uid=0\nfs.proc_super_gid=600\n")])])])]),e._v("\nAnd do:\n"),s("div",{staticClass:"notranslate"},[s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("# sysctl -p\n")])])])]),e._v("\nfs.proc_can_see_other_uid=0\n"),s("p",[e._v("If fs.proc_can_see_other_uid is set to 0, users will not be able to see special files. If it is set to 1 - user will see other processes IDs in /proc filesystem.")]),e._v(" "),s("p",[e._v("fs.proc_super_gid=XX")]),e._v(" "),s("p",[e._v("The fs.proc_super_gid sets group ID which will see system files in /proc, add any users to that group so they will see all files in /proc. Usually needed by some monitoring users like nagios or zabbix and "),s("RouterLink",{attrs:{to:"/command-line_tools/#cldetect"}},[e._v("cldetect utility")]),e._v(" can configure few most commonly used monitoring software automatically.")],1),e._v(" "),s("h4",{attrs:{id:"automatic-configuration-of-a-group-in-the-fs-proc-super-gid"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#automatic-configuration-of-a-group-in-the-fs-proc-super-gid","aria-hidden":"true"}},[e._v("#")]),e._v(" Automatic configuration of a group in the fs.proc_super_gid")]),e._v(" "),s("p",[e._v("Starting from "),s("strong",[e._v("lve-utils v.4.2.0-1")]),e._v(", when installing (not updating) the "),s("code",[e._v("lve-utils")]),e._v(" package it automatically creates the "),s("code",[e._v("clsupergid")]),e._v(" group and registers this group in the "),s("code",[e._v("fs.proc_super_gid")]),e._v(" (if this group was not created before).\nIf a group was created in the "),s("code",[e._v("fs.proc_super_gid")]),e._v(" earlier all stays the same.")]),e._v(" "),s("p",[e._v("Virtualized /proc filesystem in CloudLinux OS Shared 8/CloudLinux OS Shared 7 hybrid will display all files to unprivileged users. But unprivileged users will have access only to the following files (as well as directories for PIDs for the user):\n")]),s("div",{staticClass:"notranslate"},[s("p"),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("/proc/cpuinfo\n/proc/version\n/proc/stat\n/proc/uptime\n/proc/loadavg\n/proc/filesystems\n/proc/stat\n/proc/cmdline\n/proc/meminfo\n/proc/mounts\n/proc/net/tcp\n/proc/net/tcp6\n/proc/net/udp\n/proc/net/udp6\n/proc/net/assocs\n/proc/net/raw\n/proc/net/raw6\n/proc/net/unix\n/proc/net/dev\n")])])])]),e._v(" "),s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[e._v("Note")]),s("p",[e._v("Starting from lve-utils 3.0-21.2, fs.proc_super_gid parameter in da_add_admin utility is written to /etc/sysctl.d/90-cloudlinux.conf.")])]),s("h3",{attrs:{id:"remounting-procfs-with-hidepid-option"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#remounting-procfs-with-hidepid-option","aria-hidden":"true"}},[e._v("#")]),e._v(' Remounting procfs with "hidepid" option')]),e._v(" "),s("p",[e._v("In "),s("strong",[e._v("lve-utils-2.1-3.2")]),e._v(" and later "),s("code",[e._v("/proc")]),e._v(" can be remounted with "),s("code",[e._v("hidepid=2")]),e._v(" option to enable additional protection for procfs. This remount is performed in lve_namespaces service.\nThis option is in sync with "),s("code",[e._v("fs.proc_can_see_other_uid")]),e._v(" kernel parameter described above.\nWhen "),s("code",[e._v("/etc/sysctl.conf")]),e._v(" does not contain "),s("code",[e._v("fs.proc_can_see_other_uid")]),e._v(" setting, the protection is off (procfs is remounted with "),s("code",[e._v("hidepid=0")]),e._v(" option). In this case "),s("code",[e._v("fs.proc_super_gid")]),e._v(" setting is ignored. Users are able to see full "),s("code",[e._v("/proc")]),e._v(" including processes of other users on a server. This is a default behavior.")]),e._v(" "),s("p",[e._v("If "),s("code",[e._v("/etc/sysctl.conf")]),e._v(" contains "),s("code",[e._v("fs.proc_can_see_other_uid=1")]),e._v(" setting, then "),s("code",[e._v("/proc")]),e._v(" will be remounted with "),s("code",[e._v("hidepid=0")]),e._v(" option (disable "),s("code",[e._v("hidepid")]),e._v(" protection for all users).\nIf "),s("code",[e._v("/etc/sysctl.conf")]),e._v(" contains "),s("code",[e._v("fs.proc_can_see_other_uid=0")]),e._v(" setting, then "),s("code",[e._v("/proc")]),e._v(" will be remounted with "),s("code",[e._v("hidepid=2")]),e._v(" option (enable "),s("code",[e._v("hidepid")]),e._v(" protection for all users).\nIf "),s("code",[e._v("/etc/sysctl.conf")]),e._v(" contains "),s("code",[e._v("fs.proc_can_see_other_uid=0")]),e._v(" and "),s("code",[e._v("fs.proc_super_gid=$GID")]),e._v(" settings, then "),s("code",[e._v("/proc")]),e._v(" will be remounted with "),s("code",[e._v("hidepid=2, gid=$GID")]),e._v(" options (enable "),s("code",[e._v("hidepid")]),e._v(" for all users except users in group with gid $GID).")]),e._v(" "),s("p",[e._v("To apply "),s("code",[e._v("/etc/sysctl.conf")]),e._v(" changes, you should execute\n")]),s("div",{staticClass:"notranslate"},[s("p"),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("service lve_namespaces restart\n")])])])]),e._v("\n Or\n"),s("div",{staticClass:"notranslate"},[s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("/usr/share/cloudlinux/remount_proc.py\n")])])])]),e._v(" "),s("p",[e._v("So, admin can prevent users from seeing processes of other users via "),s("code",[e._v("fs.proc_can_see_other_uid")]),e._v(" and "),s("code",[e._v("fs.proc_super_gid")]),e._v(" settings in "),s("code",[e._v("/etc/sysctl.conf")]),e._v(", like earlier.")]),e._v(" "),s("p",[e._v("Also, you can override this by specifying desired options for "),s("code",[e._v("/proc")]),e._v(" in "),s("code",[e._v("/etc/fstab")]),e._v(".")]),e._v(" "),s("p",[e._v("To disable hidepid, add to "),s("code",[e._v("/etc/fstab")]),e._v(" the following:\n")]),s("div",{staticClass:"notranslate"},[s("p"),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("proc /proc proc defaults,hidepid=0,gid=0 0 0\n")])])])]),e._v("\nOr you can specify desired hidepid and gid values explicitly:\n"),s("div",{staticClass:"notranslate"},[s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("proc /proc proc defaults,hidepid=2,gid=clsupergid 0 0\n")])])])]),e._v("\n You should execute\n"),s("div",{staticClass:"notranslate"},[s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("mount -o remount /proc\n")])])])]),e._v(" "),s("p",[e._v("to apply "),s("code",[e._v("/etc/fstab")]),e._v(" changes."),s("br"),e._v("\nNevertheless, we recommend to manage procfs mount options via "),s("code",[e._v("/etc/sysctl.conf")]),e._v(" as described above for backward compatibility.")]),e._v(" "),s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[e._v("Note")]),s("p",[e._v("There is a known issue on CloudLinux OS Shared 6 systems. User cannot see full /proc inside CageFS even when this user is in “super” group, that should see full /proc. This issue does not affect users with CageFS disabled. CloudLinux OS Shared 7 is not affected.")])]),s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[e._v("Note")]),s("p",[e._v("Starting from lve-utils 3.0-21.2, lve_namespaces service can read parameters from the /etc/sysctl.d/90-cloudlinux.conf.")])]),s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[e._v("Note")]),s("p",[e._v("Even if fs.proc_can_see_other_uid and fs.proc_super_gid parameters are not set in config files but specified in /proc/sys, then when restarting lve_namespaces service the parameters from /proc/sys will be used. So, /proc will be remounted according to these parameters.")])]),s("h3",{attrs:{id:"remounting-procfs-on-cloudlinux-os-shared-8"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#remounting-procfs-on-cloudlinux-os-shared-8","aria-hidden":"true"}},[e._v("#")]),e._v(" Remounting procfs on CloudLinux OS Shared 8")]),e._v(" "),s("p",[e._v("On CloudLinux OS Shared 8, starting from the kernel version "),s("code",[e._v("4.18.0-193.28.1.lve1.el8.x86_64")]),e._v(" remounting is controlled by the kernel.")]),e._v(" "),s("p",[e._v("As before, admins are able to change the settings "),s("code",[e._v("fs.proc_can_see_other_uid")]),e._v(" and "),s("code",[e._v("fs.proc_super_gid")]),e._v(" in the "),s("code",[e._v("/etc/sysctl.d/90-cloudlinux.conf")]),e._v(" or "),s("code",[e._v("/etc/sysctl.conf")]),e._v(".")]),e._v(" "),s("p",[e._v("To apply changes, execute the following command:")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("sysctl --system\n")])])]),s("p",[e._v("It is no longer needed to manually run the "),s("code",[e._v("/usr/share/cloudlinux/remount_proc.py")]),e._v(" to remount "),s("code",[e._v("/proc")]),e._v(".")]),e._v(" "),s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[e._v("Note")]),s("p",[e._v("On Cloudlinux OS Shared 8, changing the "),s("code",[e._v("/etc/fstab")]),e._v(" file for setting "),s("code",[e._v("/proc")]),e._v(" remounting with the "),s("code",[e._v("hidepid=")]),e._v(" option "),s("strong",[e._v("will not cause any effect")]),e._v(" as remounting is totally controlled by the kernel and depends on the "),s("code",[e._v("fs.proc_can_see_other_uid")]),e._v(" option.")])]),s("h2",{attrs:{id:"ptrace-block"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ptrace-block","aria-hidden":"true"}},[e._v("#")]),e._v(" Ptrace block")]),e._v(" "),s("p",[e._v("Starting with kernel 3.10.0-427.18.s2.lve1.4.21 ( "),s("span",{staticClass:"notranslate"},[e._v(" CloudLinux  OS Shared")]),e._v(" 7) and 2.6.32-673.26.1.lve1.4.17 ( "),s("span",{staticClass:"notranslate"},[e._v(" CloudLinux OS Shared")]),e._v(" 6) we re-implemented "),s("span",{staticClass:"notranslate"},[e._v(" ptrace block ")]),e._v(" to protect against "),s("span",{staticClass:"notranslate"},[e._v(" ptrace ")]),e._v(" family of vulnerabilities. It prevents end user from using any "),s("span",{staticClass:"notranslate"},[e._v(" ptrace ")]),e._v(" related functionality, including such commands as "),s("span",{staticClass:"notranslate"},[e._v(" strace, lsof ")]),e._v(" or "),s("span",{staticClass:"notranslate"},[e._v(" gdb ")]),e._v(" .")]),e._v(" "),s("p",[e._v("By default, "),s("span",{staticClass:"notranslate"},[e._v(" CloudLinux OS Shared")]),e._v(" doesn't prevent "),s("span",{staticClass:"notranslate"},[e._v(" ptrace ")]),e._v(" functionality.")]),e._v(" "),s("p",[e._v("Defaults:\n")]),s("div",{staticClass:"notranslate"},[s("p"),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kernel.user_ptrace = 1\nkernel.user_ptrace_self = 1\n")])])])]),e._v(" "),s("p",[e._v("The option "),s("span",{staticClass:"notranslate"},[e._v(" kernel.user_ptrace ")]),e._v(" disables "),s("span",{staticClass:"notranslate"},[e._v(" PTRACE_ATTACH ")]),e._v(" functionality, option "),s("span",{staticClass:"notranslate"},[e._v(" kernel.user_ptrace_self ")]),e._v(" disables "),s("span",{staticClass:"notranslate"},[e._v(" PTRACE_TRACEME ")]),e._v(" .")]),e._v(" "),s("p",[e._v("To disable all "),s("span",{staticClass:"notranslate"},[e._v(" ptrace ")]),e._v(" functionality change both "),s("span",{staticClass:"notranslate"},[e._v(" sysctl ")]),e._v(" options to 0, add this section to "),s("span",{staticClass:"notranslate"},[e._v(" /etc/sysctl.conf ")]),e._v(" :\n")]),s("div",{staticClass:"notranslate"},[s("p"),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("## CL. Disable ptrace for users\nkernel.user_ptrace = 0\nkernel.user_ptrace_self = 0\n##\n")])])])]),e._v(" "),s("p",[e._v("Apply changes with:\n")]),s("div",{staticClass:"notranslate"},[s("p"),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("$ sysctl -p\n")])])])]),e._v(" "),s("p",[e._v("Different software could need different access to "),s("span",{staticClass:"notranslate"},[e._v(" ptrace ")]),e._v(" , you may need to change only one option to 0 to make them working. In this case, there will be only partial "),s("span",{staticClass:"notranslate"},[e._v(" ptrace ")]),e._v(" protection.")]),e._v(" "),s("div",{staticClass:"danger custom-block"},[s("p",{staticClass:"custom-block-title"},[e._v("DANGER")]),s("p",[e._v("ptrace protection is known to break PSA service for Plesk 11")])]),s("h2",{attrs:{id:"xen-xvda"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#xen-xvda","aria-hidden":"true"}},[e._v("#")]),e._v(" Xen XVDA")]),e._v(" "),s("p",[e._v("2.6.32 kernels have different mode of naming "),s("span",{staticClass:"notranslate"},[e._v(" Xen XVDA ")]),e._v(" drives.")]),e._v(" "),s("p",[e._v("By adding "),s("span",{staticClass:"notranslate"},[e._v(" xen_blkfront.sda_is_xvda=0 ")]),e._v(" to kernel boot line in "),s("span",{staticClass:"notranslate"},[e._v(" grub.conf ")]),e._v(" you will make sure no naming translation is done, and the drives will be identified as "),s("span",{staticClass:"notranslate"},[e._v(" xvde ")]),e._v(" .")]),e._v(" "),s("p",[e._v("By default, this option is set to 1 in the kernel, and drives are detected as "),s("span",{staticClass:"notranslate"},[e._v(" xvda ")]),e._v(" .\nThis is needed only for CloudLinux OS Shared 6 and "),s("span",{staticClass:"notranslate"},[e._v(" Hybrid ")]),e._v(" kernels.")]),e._v(" "),s("h2",{attrs:{id:"umask-behavior"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#umask-behavior","aria-hidden":"true"}},[e._v("#")]),e._v(" Umask behavior")]),e._v(" "),s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[e._v("Note")]),s("p",[e._v("CloudLinux OS Shared 6, CloudLinux OS Shared 6 hybrid, CloudLinux OS Shared 7, CloudLinux OS Shared 7 hybrid kernels.")])]),s("p",[e._v("Starting from the kernel module "),s("strong",[e._v("lve-kmod-2.0-10")]),e._v(", the behavior of umask is changed.")]),e._v(" "),s("p",[e._v("Now, when entering LVE task's original umask value is preserved, instead of using LVE's umask value.\nThis behavior is typical for all kernels: CloudLinux OS Shared 6, CloudLinux OS Shared 6 hybrid, CloudLinux OS Shared 7, CloudLinux OS Shared 7 hybrid kernels.")]),e._v(" "),s("h2",{attrs:{id:"io-limits-latency"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#io-limits-latency","aria-hidden":"true"}},[e._v("#")]),e._v(" IO limits latency")]),e._v(" "),s("p",[s("strong",[e._v("[lve1.2.29+]")])]),e._v(" "),s("p",[e._v("When customer reaches "),s("span",{staticClass:"notranslate"},[e._v(" IO Limit, the processes that are waiting for  "),s("span",{staticClass:"notranslate"},[e._v(" IO will be placed to sleep to make sure they don't go over the limit. That could make some processes sleep for a very long time. ")])]),e._v("\nBy defining "),s("span",{staticClass:"notranslate"},[e._v(" IO latency, you can make sure that no process sleeps due to  "),s("span",{staticClass:"notranslate"},[e._v(" IO limit for more then X milliseconds. By doing so, you will also let customers to burst through the limits, and use up more than they were limited too in some instances. ")])])]),e._v(" "),s("p",[e._v("This option is "),s("span",{staticClass:"notranslate"},[e._v(" OFF by default. ")])]),e._v(" "),s("p",[s("em",[e._v("For CloudLinux OS Shared 6 , CloudLinux OS Shared 7, CloudLinux OS Shared 8 (kmodlve 2.1-2 and later):")])]),e._v(" "),s("p",[e._v("To enable "),s("span",{staticClass:"notranslate"},[e._v(" IO ")]),e._v(" Limits latency and set it to 10 seconds:\n")]),s("div",{staticClass:"notranslate"},[s("p"),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("# echo 10000 > /sys/module/kmodlve/parameters/latency\n")])])])]),e._v("\nTo disable latency:\n"),s("div",{staticClass:"notranslate"},[s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("# echo 2000000000 > /sys/module/kmodlve/parameters/latency\n")])])])]),e._v(" "),s("p",[e._v("It is possible to set, for example, 1000 as a permanent value. To do so, create a file "),s("span",{staticClass:"notranslate"},[e._v("/etc/modprobe.d/kmodlve.conf ")]),e._v(" with the following content:"),s("br"),e._v(" "),s("span",{staticClass:"notranslate"},[s("code",[e._v("options kmodlve latency=1000")])])]),e._v(" "),s("p",[s("em",[e._v("For "),s("span",{staticClass:"notranslate"},[e._v(" CloudLinux OS Shared")]),e._v(" 5 (OBSOLETE):")])]),e._v(" "),s("p",[e._v("To enable "),s("span",{staticClass:"notranslate"},[e._v(" IO ")]),e._v(" Limits latency and set it to 10 seconds:\n")]),s("div",{staticClass:"notranslate"},[s("p"),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("# echo 10000 > /sys/module/iolimits/**parameters/latency\n")])])])]),e._v("\nTo disable latency:\n"),s("div",{staticClass:"notranslate"},[s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("# echo 2000000000 > /sys/module/iolimits/**parameters/latency\n")])])])]),e._v(" "),s("h2",{attrs:{id:"reading-lve-usage"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reading-lve-usage","aria-hidden":"true"}},[e._v("#")]),e._v(" Reading LVE usage")]),e._v(" "),s("p",[e._v("CloudLinux OS Shared kernel provides real time usage data in file.")]),e._v(" "),s("p",[e._v("All the statistics can be read from that file in real time. Depending on your kernel version you will get either Version 6 of the file, or version 4 of the file.\nYou can detect the version by reading the first line of the file. It should look like:")]),e._v(" "),s("p",[e._v("6:LVE... for version 6"),s("br"),e._v("\n4:LVE... for version 4")]),e._v(" "),s("p",[e._v("First line presents headers for the data.\nSecond line shows default limits for the server, with all other values being 0.\nThe rest of the lines present limits & usage data on per "),s("span",{staticClass:"notranslate"},[e._v(" LVE ")]),e._v(" bases.")]),e._v(" "),s("p",[e._v("Version 6 (CL6 & hybrid kernels):\n")]),s("div",{staticClass:"notranslate"},[s("p"),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("6:LVE        EP        lCPU        lIO        CPU        MEM        IO        lMEM        lEP        nCPU        fMEM        fEP        lMEMPHY        lCPUW        lNPROC        MEMPHY        fMEMPHY        NPROC        fNPROC\n0        0        25        1024        0        0        0        262144        20        1        0        0        262144        100        0        0        0        00\n300        0        25        1024        1862407        0        0        262144        20        1        0        0        262144        100        0        31        000\n")])])])]),e._v(" "),s("table",[s("thead",[s("tr",[s("th"),e._v(" "),s("th"),e._v(" "),s("th"),e._v(" "),s("th")])]),e._v(" "),s("tbody",[s("tr",[s("td",[s("strong",[e._v("Label")])]),e._v(" "),s("td",[s("strong",[e._v("Description")])]),e._v(" "),s("td",[s("strong",[e._v("Value")])]),e._v(" "),s("td",[s("strong",[e._v("Supported versions")])])]),e._v(" "),s("tr",[s("td",[s("span",{staticClass:"notranslate"},[e._v(" LVE ")])]),e._v(" "),s("td",[s("span",{staticClass:"notranslate"},[e._v(" LVE ID ")])]),e._v(" "),s("td",[e._v("number")]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",[s("span",{staticClass:"notranslate"},[e._v(" EP ")])]),e._v(" "),s("td",[e._v("Number of "),s("span",{staticClass:"notranslate"},[e._v(" entry processes ")])]),e._v(" "),s("td",[e._v("number")]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",[s("span",{staticClass:"notranslate"},[e._v(" lCPU ")])]),e._v(" "),s("td",[s("span",{staticClass:"notranslate"},[e._v(" CPU ")]),e._v(" Limit")]),e._v(" "),s("td",[e._v("% relative to total "),s("span",{staticClass:"notranslate"},[e._v(" CPU power ")])]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",[s("span",{staticClass:"notranslate"},[e._v(" lIO ")])]),e._v(" "),s("td",[s("span",{staticClass:"notranslate"},[e._v(" IO ")]),e._v(" limits for CL6")]),e._v(" "),s("td",[e._v("KB/s for v6, from 1 to 100 for v4")]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",[s("span",{staticClass:"notranslate"},[e._v(" CPU ")])]),e._v(" "),s("td",[s("span",{staticClass:"notranslate"},[e._v(" CPU ")]),e._v(" usage since reboot")]),e._v(" "),s("td",[e._v("in nanoseconds for v6, hertz for v4")]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",[s("span",{staticClass:"notranslate"},[e._v(" MEM ")])]),e._v(" "),s("td",[e._v("Virtual memory usage")]),e._v(" "),s("td",[e._v("number of 4k pages")]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",[s("span",{staticClass:"notranslate"},[e._v(" IO ")])]),e._v(" "),s("td",[s("span",{staticClass:"notranslate"},[e._v(" IO ")]),e._v(" usage")]),e._v(" "),s("td",[e._v("KB/s for v6, 0 for v4")]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",[s("span",{staticClass:"notranslate"},[e._v(" lMEM ")])]),e._v(" "),s("td",[e._v("Virtual memory limit")]),e._v(" "),s("td",[e._v("number of 4k pages")]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",[s("span",{staticClass:"notranslate"},[e._v(" lEP ")])]),e._v(" "),s("td",[s("span",{staticClass:"notranslate"},[e._v(" Entry Processes ")]),e._v(" limit")]),e._v(" "),s("td",[e._v("number")]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",[s("span",{staticClass:"notranslate"},[e._v(" nCPU ")])]),e._v(" "),s("td",[e._v("Number of cores limit")]),e._v(" "),s("td",[e._v("number of cores")]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",[s("span",{staticClass:"notranslate"},[e._v(" fMEM ")])]),e._v(" "),s("td",[s("span",{staticClass:"notranslate"},[e._v(" Virtual memory ")]),e._v(" faults")]),e._v(" "),s("td",[e._v("number of faults")]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",[s("span",{staticClass:"notranslate"},[e._v(" fEP ")])]),e._v(" "),s("td",[s("span",{staticClass:"notranslate"},[e._v(" Entry Processes ")]),e._v(" faults")]),e._v(" "),s("td",[e._v("number of faults")]),e._v(" "),s("td",[e._v("v6+")])]),e._v(" "),s("tr",[s("td",[s("span",{staticClass:"notranslate"},[e._v(" lMEMPHY ")])]),e._v(" "),s("td",[e._v("Physical memory limit")]),e._v(" "),s("td",[e._v("number")]),e._v(" "),s("td",[e._v("v6+")])]),e._v(" "),s("tr",[s("td",[s("span",{staticClass:"notranslate"},[e._v(" lCPUW ")])]),e._v(" "),s("td",[s("span",{staticClass:"notranslate"},[e._v(" CPU ")]),e._v(" weight (not used)")]),e._v(" "),s("td",[e._v("from 1 to 100")]),e._v(" "),s("td",[e._v("v6+")])]),e._v(" "),s("tr",[s("td",[s("span",{staticClass:"notranslate"},[e._v(" lNPROC ")])]),e._v(" "),s("td",[s("span",{staticClass:"notranslate"},[e._v(" Number of processes ")]),e._v(" limit")]),e._v(" "),s("td",[e._v("number")]),e._v(" "),s("td",[e._v("v6+")])]),e._v(" "),s("tr",[s("td",[s("span",{staticClass:"notranslate"},[e._v(" MEMPHY ")])]),e._v(" "),s("td",[e._v("Physical memory usage")]),e._v(" "),s("td",[e._v("number of 4k pages")]),e._v(" "),s("td",[e._v("v6+")])]),e._v(" "),s("tr",[s("td",[s("span",{staticClass:"notranslate"},[e._v(" fMEMPHY ")])]),e._v(" "),s("td",[e._v("Physical memory faults")]),e._v(" "),s("td",[e._v("number of faults")]),e._v(" "),s("td",[e._v("v6+")])]),e._v(" "),s("tr",[s("td",[s("span",{staticClass:"notranslate"},[e._v(" NPROC ")])]),e._v(" "),s("td",[s("span",{staticClass:"notranslate"},[e._v(" Number of processes ")])]),e._v(" "),s("td",[e._v("number")]),e._v(" "),s("td",[e._v("v6+")])]),e._v(" "),s("tr",[s("td",[s("span",{staticClass:"notranslate"},[e._v(" fNPROC ")])]),e._v(" "),s("td",[s("span",{staticClass:"notranslate"},[e._v(" Number of processes ")]),e._v(" faults")]),e._v(" "),s("td",[e._v("number of faults")]),e._v(" "),s("td",[e._v("v6+")])]),e._v(" "),s("tr",[s("td",[s("span",{staticClass:"notranslate"},[e._v(" IOPS ")])]),e._v(" "),s("td",[s("span",{staticClass:"notranslate"},[e._v(" IO ")]),e._v(" operations since reboot")]),e._v(" "),s("td",[e._v("number")]),e._v(" "),s("td",[e._v("v8+")])])])]),e._v(" "),s("h2",{attrs:{id:"flashcache"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#flashcache","aria-hidden":"true"}},[e._v("#")]),e._v(" Flashcache")]),e._v(" "),s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[e._v("Note")]),s("p",[e._v("Available only for x86_64, "),s("span",{staticClass:"notranslate"},[e._v("CloudLinux")]),e._v(" OS Shared 6 and Hybrid servers")])]),s("p",[s("span",{staticClass:"notranslate"},[e._v(" Flashcache ")]),e._v(" is a module originally written and released by "),s("span",{staticClass:"notranslate"},[e._v("  Facebook (Mohan Srinivasan, Paul Saab ")]),e._v(" and "),s("span",{staticClass:"notranslate"},[e._v(" Vadim Tkachenko ")]),e._v(" ) in April of 2010. It is a kernel module that allows Writethrough caching of a drive on another drive. This is most often used for caching a rotational drive on a smaller solid-state drive for performance reasons. This gives you the speed of an "),s("span",{staticClass:"notranslate"},[e._v(" SSD ")]),e._v(" and the size of a standard rotational drive for recently cached files. "),s("span",{staticClass:"notranslate"},[e._v(" Facebook ")]),e._v(" originally wrote the module to speed up database "),s("span",{staticClass:"notranslate"},[e._v(" I/O ")]),e._v(" , but it is easily extended to any "),s("span",{staticClass:"notranslate"},[e._v(" I/O ")]),e._v(" .")]),e._v(" "),s("p",[e._v("To install on "),s("span",{staticClass:"notranslate"},[e._v(" CloudLinux OS Shared")]),e._v(" 6 & Hybrid servers:\n")]),s("div",{staticClass:"notranslate"},[s("p"),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("$ yum install flashcache\n")])])])]),e._v(" "),s("p",[e._v("More info on "),s("span",{staticClass:"notranslate"},[e._v(" flashcache ")]),e._v(" : "),s("a",{attrs:{href:"https://github.com/facebook/flashcache/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/facebook/flashcache/"),s("OutboundLink")],1)]),e._v(" "),s("p",[s("span",{staticClass:"notranslate"},[e._v(" ArchLinux ")]),e._v(" has a good page explaining how to use "),s("span",{staticClass:"notranslate"},[e._v(" flashcache ")]),e._v(" :\n"),s("a",{attrs:{href:"https://wiki.archlinux.org/index.php/Flashcache",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://wiki.archlinux.org/index.php/Flashcache"),s("OutboundLink")],1)]),e._v(" "),s("h2",{attrs:{id:"oom-killer-for-lve-processes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#oom-killer-for-lve-processes","aria-hidden":"true"}},[e._v("#")]),e._v(" OOM killer for LVE processes")]),e._v(" "),s("p",[e._v("When "),s("span",{staticClass:"notranslate"},[e._v("LVE")]),e._v(" reaches its memory limit, the processes inside that "),s("span",{staticClass:"notranslate"},[e._v(" LVE ")]),e._v(" are killed by "),s("span",{staticClass:"notranslate"},[e._v(" OOM Killer ")]),e._v(" and appropriate message is written to "),s("span",{staticClass:"notranslate"},[e._v(" /var/log/messages ")]),e._v(" . When any "),s("span",{staticClass:"notranslate"},[e._v(" LVE ")]),e._v(" hits huge number of memory limits in short period of time, then "),s("span",{staticClass:"notranslate"},[e._v(" OOM Killer ")]),e._v(" could cause system overload. Starting from kernel 2.6.32-673.26.1.lve1.4.15 ( "),s("span",{staticClass:"notranslate"},[e._v(" CloudLinux OS Shared")]),e._v(" 6) and from kernel 3.10.0-427.18.2.lve1.4.14 ( "),s("span",{staticClass:"notranslate"},[e._v(" CloudLinux OS Shared")]),e._v(" 7) heavy "),s("span",{staticClass:"notranslate"},[e._v(" OOM Killer ")]),e._v(" could be disabled. If so - lightweight "),s("span",{staticClass:"notranslate"},[e._v(" SIGKILL ")]),e._v(" will be used instead.")]),e._v(" "),s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[e._v("Note")]),s("p",[e._v("It is recommended to disable OOM killer for LVE processes and use SIGKILL instead")])]),s("p",[e._v("By default "),s("span",{staticClass:"notranslate"},[e._v(" OOM Killer ")]),e._v(" is enabled, to disable it please run:")]),e._v(" "),s("p",[s("em",[e._v("For "),s("span",{staticClass:"notranslate"},[e._v(" CloudLinux OS Shared")]),e._v(" 6")]),e._v(" :\n")]),s("div",{staticClass:"notranslate"},[s("p"),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("# echo 1 > /proc/sys/ubc/ubc_oom_disable\n")])])])]),e._v(" "),s("p",[e._v("Also, add the following to "),s("span",{staticClass:"notranslate"},[s("em",[e._v("/etc/sysctl.conf")])]),e._v(" file to apply the same during boot:\n")]),s("div",{staticClass:"notranslate"},[s("p"),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("ubc.ubc_oom_disable=1\n")])])])]),e._v(" "),s("p",[s("em",[e._v("For "),s("span",{staticClass:"notranslate"},[e._v(" CloudLinux OS Shared")]),e._v(" 7:")])]),e._v(" "),s("div",{staticClass:"notranslate"},[s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("# echo 1 > /proc/sys/kernel/memcg_oom_disable\n")])])])]),e._v(" "),s("p",[e._v("Also, add the following to "),s("span",{staticClass:"notranslate"},[s("code",[e._v("/etc/sysctl.conf")])]),e._v(" file to apply the same during boot:")]),e._v(" "),s("div",{staticClass:"notranslate"},[s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kernel.memcg_oom_disable=1\n")])])])]),e._v(" "),s("h2",{attrs:{id:"file-system-quotas"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#file-system-quotas","aria-hidden":"true"}},[e._v("#")]),e._v(" File system quotas")]),e._v(" "),s("p",[e._v("In "),s("span",{staticClass:"notranslate"},[s("strong",[e._v("Ext4")])]),e._v(" file system, the process with enabled capability "),s("span",{staticClass:"notranslate"},[e._v(" CAP_SYS_RESOURCE ")]),e._v(" is not checked on the quota exceeding by default. It allows userland utilities "),s("span",{staticClass:"notranslate"},[s("em",[e._v("selectorctl")])]),e._v(" and "),s("span",{staticClass:"notranslate"},[s("em",[e._v("cagefs")])]),e._v(" to operate without fails even if a user exceeds a quota.")]),e._v(" "),s("p",[e._v("To disable quota checking in "),s("span",{staticClass:"notranslate"},[s("strong",[e._v("XFS")])]),e._v(" file system set "),s("span",{staticClass:"notranslate"},[s("code",[e._v("cap_res_quota_disable")])]),e._v(" option to 1 using the following command:")]),e._v(" "),s("div",{staticClass:"notranslate"},[s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("# echo 1 > /proc/sys/fs/xfs/cap_res_quota_disable\n")])])])]),e._v(" "),s("h2",{attrs:{id:"enter-lve-when-using-cpanel-utilities"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#enter-lve-when-using-cpanel-utilities","aria-hidden":"true"}},[e._v("#")]),e._v(" Enter LVE when using cPanel utilities "),s("Badge",{attrs:{text:"cPanel"}}),e._v(" "),s("Badge",{attrs:{text:"CloudLinux OS Shared 7 hybrid"}}),e._v(" "),s("Badge",{attrs:{text:"experimental",type:"warn"}})],1),e._v(" "),s("p",[e._v("cPanel tools might use more resources than desired, so to limit resource usage, you might want to enter the corresponding LVE when using cPanel tools on-behalf of a non-root user.")]),e._v(" "),s("p",[e._v("This feature is considered experimental, as in this case there might be contention for LVE limits between cPanel tools and web-requests for a given user, which might not be suitable.")]),e._v(" "),s("p",[e._v("The "),s("span",{staticClass:"notranslate"},[s("code",[e._v("lve_setuid_enter")])]),e._v(" parameter controls whether you want to enter the corresponding LVE when using cPanel tools on behalf of a non-root user.")]),e._v(" "),s("p",[e._v("By default, the feature is disabled (0), to enable it, run the following for CloudLinux OS Shared 7 hybrid:")]),e._v(" "),s("div",{staticClass:"notranslate"},[s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("# echo 1 > /sys/module/kmodlve/parameters/lve_setuid_enter\n")])])])]),e._v(" "),s("h2",{attrs:{id:"proactive-reporting-kernel-crash-events-with-sentry-and-kernel-panic-receiver"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#proactive-reporting-kernel-crash-events-with-sentry-and-kernel-panic-receiver","aria-hidden":"true"}},[e._v("#")]),e._v(" Proactive reporting kernel crash events with Sentry and Kernel Panic Receiver")]),e._v(" "),s("p",[e._v("As updating the kernel is one of the most sensitive tasks, we'd like to achieve the maximum stability along the way.\nIn case something goes wrong, proactive reacting to kernel crashes can help tremendously.")]),e._v(" "),s("p",[e._v("Our new tool, "),s("em",[e._v("Kernel Panic Receiver")]),e._v(", released in "),s("a",{attrs:{href:"https://blog.cloudlinux.com/kernel-panic-receiver-a-new-tool-to-organize-kernel-panic-logs",target:"_blank",rel:"noopener noreferrer"}},[e._v("June 2020"),s("OutboundLink")],1),e._v(" allows you to to organize kernel panic logs.\nKernel Panic Receiver is an open-source component designed to pre-emptively resolve any kernel-related issues.")]),e._v(" "),s("p",[e._v("Visit the "),s("a",{attrs:{href:"https://github.com/cloudlinux/kernel_panic_receiver",target:"_blank",rel:"noopener noreferrer"}},[e._v("Kernel Panic Receiver project GitHub page"),s("OutboundLink")],1),e._v(".")]),e._v(" "),s("h4",{attrs:{id:"usage"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#usage","aria-hidden":"true"}},[e._v("#")]),e._v(" Usage")]),e._v(" "),s("p",[e._v("To send required kernel logs from the clients' machines to "),s("em",[e._v("Kernel Panic Receiver")]),e._v(", we configure the default Linux kernel feature called "),s("em",[e._v("netconsole")]),e._v(".")]),e._v(" "),s("p",[e._v("The configuration is done by the "),s("code",[e._v("initscripts")]),e._v(" package, starting from the following versions:")]),e._v(" "),s("ul",[s("li",[e._v("For CloudLinux OS Shared 6: "),s("code",[e._v("9.03.61-1.cloudlinux")])]),e._v(" "),s("li",[e._v("For CloudLinux OS Shared 7: "),s("code",[e._v("9.49.49-1.cloudlinux")])]),e._v(" "),s("li",[e._v("For CloudLinux OS Shared 8: "),s("code",[e._v("10.00.4-1.cloudlinux")])])]),e._v(" "),s("p",[e._v("To update the "),s("code",[e._v("initscripts")]),e._v(" package, run the following command:")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("yum update initscripts --enablerepo=cloudlinux-updates-testing\n")])])]),s("p",[e._v("When a kernel panic occurs, the "),s("em",[e._v("netconsole")]),e._v(" module sends logs to our server as plain text via the UDP protocol.")]),e._v(" "),s("h4",{attrs:{id:"what-data-is-transferred-by-netconsole"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#what-data-is-transferred-by-netconsole","aria-hidden":"true"}},[e._v("#")]),e._v(" What data is transferred by netconsole?")]),e._v(" "),s("p",[e._v("The "),s("em",[e._v("netconsole")]),e._v(" sends only OOPs-related messages from the kernel ring buffer. It doesn't transfer any sensitive data, such as usernames, encryption keys, paths, etc. So, there are no security problems you should worry about.")]),e._v(" "),s("h3",{attrs:{id:"disabling-the-feature"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#disabling-the-feature","aria-hidden":"true"}},[e._v("#")]),e._v(" Disabling the feature")]),e._v(" "),s("p",[e._v("If you don't want to send us the data, you can turn the "),s("em",[e._v("netconsole")]),e._v(" service off (we don't recommend it, though).\nTo disable transferring the data, just comment the "),s("code",[e._v("SYSLOGADDR")]),e._v(" parameter in the "),s("em",[e._v("netconsole")]),e._v(" config file ("),s("code",[e._v("/etc/sysconfig/netconsole")]),e._v("):")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("# For more information about this data transmission, check this page:\n# https://cloudlinux.zendesk.com/hc/en-us/articles/360016481200\n# SYSLOGADDR=sentrykernel.cloudlinux.com\n")])])]),s("p",[e._v("And stop the "),s("em",[e._v("netconsole")]),e._v(" service by running the following command:")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("service netconsole stop\n")])])]),s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[e._v("Note")]),s("p",[s("em",[e._v("Netconsole")]),e._v(" is used only for Kernel Panic Receiver, so disabling it doesn't lead to issues with other CloudLinux OS Shared services.")])])])},[],!1,null,null,null);t.default=n.exports}}]);